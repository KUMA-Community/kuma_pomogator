# kuma_pomogator

Сервис на python с веб-интерфейсом, который позволяет выполнять некоторые операции с KUMA с помощью интерфейса через public REST API

# Требования

Для корректной работы необходимо установить gradio последней версии командой

```
pip install gradio --upgrade
```

# Быстрый старт

Для запуска программы перейдите в папку со скриптом и выполните команду

```
python main.py
```

Веб-интерфейс будет доступен по адресу `http://127.0.0.1:7860`

Для переопредления адреса, порта или протокола консоли используйте переменные окружения. Подробности - в документации [gradio](https://www.gradio.app/guides/environment-variables).

# Работа с программой

Для начала работы в верхнем окне интерфейса укажите адрес, api-порт и токен для ядра KUMA и нажмите кнопку Connect. Если все введенные данные были верны, под кнопкой подключения отобразится Status: Connected и отобразятся основные вкладки работы с программой.

## Вкладка Export

На данной вкладке можно экспортировать алерты, инциденты и правила корреляции в формате CSV.

Поля фильтрации алертов и инцидентов по таймстемпу не являются обязательными.

Необходимые права экспорта алертов:

- GET /alerts

Необходимые права для экспорта инцидентов:

- GET /incidents

Необходимые права для экспорта правил корреляции:

- GET /tenants
- GET /services
- GET /services/:kind/:id
- GET /resources

## Вкладка Assets

На данной вкладке можно импортировать активы в формате CSV. Ожидаемый формат приведен в веб-интерфейсе.

Если то или иное поле отсутствует для актива, оставьте его пустым.

Если то или иное поле соджерит запятую внутри, возьмите значение поле в двойные кавычки.

Сервис не проверяет корректность введенных данных (IP, FQDN, MAC). При ошибках в этих полях хотя бы для одного актива не будет импортирован весь список, при этом вернется всплывающая ошибка с указанием на актив.

Также для импорта актива необходимо указать тенант, в который активы будут импортированы.

Необходимые прва для импорта активов:

- GET /tenants
- POST /assets/import

## Вкладка Backup/Restore

На данной вкладке можно скачать бэкап архива ядра, а также загрузить бэкап и запустить процедуру восстановления.

Т.к. бэкап при больших объемах базы занимает некоторое время - наберитесь терпения и не закрывайте вкладку (с самой вкладки можно уйти и при возвращении бэкап будет загружен).

Необходимые прва для создания бэкапа:

- GET /system/backup

Необходимые прва для восстановления бэкапа:

- POST /system/restore

## Вкладка Analyzer

На этой вкладке вы можете проанализировать любой ресурс KUMA в формате JSON.

Обязательно укажите тип ресурса для поиска. Имя ресурса опционально, но его указание сократит время поиска. Также обратите внимание, что имя ресурса - регулярное выражение.

После того как ресурсы будут найдены выберите в выпадающем меню интересующий ресурс и нажмите кнопку ниже - вы увидите ресурс в формате JSON.

Для копирования ресурса нажмите на значок копирования в правом верхнем углу окна с JSON.

Необходимые права для просмотра ресурсов:

- GET /resources

# Известные ограничения

1. Сервис не сохраняет свое состояние - при перезагрузке вкладки все введенные данные нужно будет вводить заново, в т.ч. адрес и токен и выполнять подключение.
2. При выборе большого ресурса для анализа (например, парсер Cisco) могут наблюдаться зависания интерфейса. В таком случае рекомендуется скопировать ресурс и проанализировать его, например, в notepad++.
3. Все файлы для скачивания имеют рандомное название, что связано с использованием tempfile.
